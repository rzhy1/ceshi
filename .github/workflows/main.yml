name: "æµ‹è¯•"
#dsafghj
on:
  workflow_dispatch:
  push:
    branches:
      - "*"
  pull_request:
    branches:
      - "*"
  release:
    types:
      - released
  schedule:
    - cron: "0 0 * * *"
jobs:
  build:
    runs-on: ubuntu-24.04
    steps:
      - name: Find and configure fastest Ubuntu mirror
        run: |
          wget http://ftp.de.debian.org/debian/pool/main/n/netselect/netselect_0.3.ds1-29_amd64.deb

          # å®‰è£…ä¸‹è½½çš„åŒ…
          sudo dpkg -i netselect_0.3.ds1-29_amd64.deb
          
          # å¦‚æžœå®‰è£…è¿‡ç¨‹ä¸­å‡ºçŽ°ä¾èµ–é—®é¢˜ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ä¿®å¤ï¼š
          sudo apt-get -f install
          # èŽ·å–é•œåƒåˆ—è¡¨å¹¶æµ‹è¯•æœ€å¿«çš„ä¸€ä¸ª
          FASTEST=$(wget -qO- mirrors.ubuntu.com/mirrors.txt | xargs -n1 | netselect -s1 -t20 2>/dev/null | awk '{print $2}' | head -n1)

          # å¦‚æžœæ²¡æ‰¾åˆ°ï¼Œç»™ä¸ªé»˜è®¤å€¼
          if [ -z "$FASTEST" ]; then
            FASTEST="archive.ubuntu.com"
          fi

          # ðŸŒŸ ç›´æŽ¥åœ¨ç•Œé¢é«˜äº®æ˜¾ç¤ºç»“æžœ
          echo "âœ… æœ€å¿«çš„æºæ˜¯: $FASTEST"

          # å¯é€‰ï¼šåœ¨ GitHub Actions Job Summary é‡ŒåŠ ä¸ªé†’ç›®æ˜¾ç¤º
          echo "## ðŸ† æœ€å¿« Ubuntu é•œåƒæº" >> $GITHUB_STEP_SUMMARY
          echo "**â†’ \`$FASTEST\`**" >> $GITHUB_STEP_SUMMARY
